---
layout: default
---

<div class="realizzazione-dettaglio">
  <div class="realizzazione-header">
    <h1>{{ page.nome }}</h1>
    <p class="realizzazione-location">üìç {{ page.citta }}</p>
  </div>

  {% if page.descrizione %}
  <div class="realizzazione-descrizione">
    <p>{{ page.descrizione }}</p>
  </div>
  {% endif %}

    <div class="realizzazione-galleria">
    {% assign cartella = page.cartella_foto | default: page.nome | slugify | prepend: '/assets/img/realizzazioni/' %}
    
    <!-- Galleria immagini -->
    <div class="galleria-container">
      {% if page.immagini %}
        <div class="galleria-grid">
          {% for immagine in page.immagini %}
            {% assign nome_pulito = immagine | split: '.' | first | replace: '-', ' ' | replace: '_', ' ' %}
            <div class="galleria-item" onclick="openLightbox({{ forloop.index0 }})">
              <img src="{{ cartella }}/{{ immagine }}" alt="{{ page.nome }} - {{ immagine }}" loading="lazy">
              <div class="zoom-overlay">
                <span class="zoom-icon">üîç</span>
              </div>
              <div class="immagine-descrizione">{{ nome_pulito | capitalize }}</div>
            </div>
          {% endfor %}
        </div>
      {% else %}
        <div class="galleria-grid">
          <div class="galleria-item" onclick="openLightbox(0)">
            <img src="{{ cartella }}/{{ page.foto_copertina | default: 'foto1.jpg' }}" alt="{{ page.nome }} - Foto 1" loading="lazy">
            <div class="zoom-overlay">
              <span class="zoom-icon">üîç</span>
            </div>
          </div>
          <div class="galleria-item" onclick="openLightbox(1)">
            <img src="{{ cartella }}/foto2.jpg" alt="{{ page.nome }} - Foto 2" loading="lazy">
            <div class="zoom-overlay">
              <span class="zoom-icon">üîç</span>
            </div>
          </div>
          <div class="galleria-item" onclick="openLightbox(2)">
            <img src="{{ cartella }}/foto3.jpg" alt="{{ page.nome }} - Foto 3" loading="lazy">
            <div class="zoom-overlay">
              <span class="zoom-icon">üîç</span>
            </div>
          </div>
          <div class="galleria-item" onclick="openLightbox(3)">
            <img src="{{ cartella }}/foto4.jpg" alt="{{ page.nome }} - Foto 4" loading="lazy">
            <div class="zoom-overlay">
              <span class="zoom-icon">üîç</span>
            </div>
          </div>
        </div>
      {% endif %}
    </div>
  </div>

  <!-- Lightbox Modal -->
    <!-- Lightbox -->
  <div id="lightbox" class="lightbox" onclick="closeLightbox()">
    <span class="lightbox-close" onclick="closeLightbox()">&times;</span>
    <div class="lightbox-content" onclick="event.stopPropagation()">
      <img id="lightbox-img" src="" alt="">
      <div id="lightbox-description" class="lightbox-description"></div>
      <button class="lightbox-nav lightbox-prev" onclick="changeImage(-1)">&#10094;</button>
      <button class="lightbox-nav lightbox-next" onclick="changeImage(1)">&#10095;</button>
      <div id="lightbox-counter" class="lightbox-counter"></div>
      <div class="lightbox-help">
        <div>üñ±Ô∏è Rotella: Zoom</div>
        <div>üñ±Ô∏è Trascina: Sposta</div>
        <div>‚ÜïÔ∏è Frecce: Naviga</div>
        <div>2√ó Click: Reset</div>
      </div>
    </div>
  </div>

  <!-- Sezione Mappa -->
  {% if page.google_maps %}
  <div class="realizzazione-mappa">
    <h3>üìç Posizione</h3>
    <div class="mappa-container">
      {% comment %}
      Metodo semplice e gratuito: iframe con Google Maps standard
      Funziona con qualsiasi link di Google Maps
      {% endcomment %}
      
      {% assign search_query = page.nome | append: ', ' | append: page.citta | url_encode %}
      
      <iframe 
        src="https://maps.google.com/maps?q={{ search_query }}&t=&z=15&ie=UTF8&iwloc=&output=embed"
        width="100%" 
        height="300" 
        style="border:0;" 
        allowfullscreen="" 
        loading="lazy"
        title="Mappa di {{ page.nome }}, {{ page.citta }}">
      </iframe>
      
      <div class="mappa-info">
        <p><strong>{{ page.nome }}</strong></p>
        <p>üìç {{ page.citta }}</p>
      </div>
      
      <div class="mappa-link">
        <a href="{{ page.google_maps }}" target="_blank" rel="noopener noreferrer" class="btn-mappa">
          üó∫Ô∏è Apri in Google Maps
        </a>
      </div>
    </div>
  </div>
  {% endif %}

  <div class="realizzazione-footer">
    <a href="/realizzazioni.html" class="btn-back">‚Üê Torna alle realizzazioni</a>
  </div>
</div>

<style>
.realizzazione-dettaglio {
  max-width: 1000px;
  margin: 0 auto;
  padding: 2rem 1rem;
}

.realizzazione-header {
  text-align: center;
  margin-bottom: 2rem;
}

.realizzazione-header h1 {
  color: #333;
  margin-bottom: 0.5rem;
}

.realizzazione-location {
  font-size: 1.1rem;
  color: #666;
  margin: 0;
}

.realizzazione-descrizione {
  background: #f9f9f9;
  padding: 1.5rem;
  border-radius: 8px;
  margin-bottom: 2rem;
  border-left: 4px solid #0073aa;
}

.realizzazione-descrizione p {
  margin: 0;
  font-size: 1.1rem;
  line-height: 1.6;
}

.galleria-container {
  margin-bottom: 2rem;
}

.galleria-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
  gap: 1rem;
}

.galleria-item {
  position: relative;
  overflow: hidden;
  border-radius: 8px;
  box-shadow: 0 4px 6px rgba(0,0,0,0.1);
  transition: transform 0.3s ease, box-shadow 0.3s ease;
  cursor: pointer;
}

.galleria-item:hover {
  transform: translateY(-5px);
  box-shadow: 0 8px 15px rgba(0,0,0,0.2);
}

.galleria-item img {
  width: 100%;
  height: 250px;
  object-fit: cover;
  transition: transform 0.3s ease;
}

.galleria-item:hover img {
  transform: scale(1.05);
}

.zoom-overlay {
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background: rgba(0,0,0,0.5);
  display: flex;
  align-items: center;
  justify-content: center;
  opacity: 0;
  transition: opacity 0.3s ease;
}

.galleria-item:hover .zoom-overlay {
  opacity: 1;
}

.zoom-icon {
  font-size: 2rem;
  color: white;
}

/* Stili per le descrizioni delle immagini */
.immagine-descrizione {
  position: absolute;
  bottom: 0;
  left: 0;
  right: 0;
  background: linear-gradient(to top, rgba(0,0,0,0.8) 0%, transparent 100%);
  color: white;
  padding: 0.75rem;
  font-size: 0.9rem;
  text-align: center;
  transform: translateY(100%);
  transition: transform 0.3s ease;
}

.galleria-item:hover .immagine-descrizione {
  transform: translateY(0);
}

/* Descrizione nel lightbox */
.lightbox-description {
  position: absolute;
  bottom: 80px;
  left: 50%;
  transform: translateX(-50%);
  background: rgba(0,0,0,0.7);
  color: white;
  padding: 0.75rem 1.5rem;
  border-radius: 20px;
  font-size: 1rem;
  text-align: center;
  backdrop-filter: blur(10px);
  border: 1px solid rgba(255,255,255,0.1);
}

.no-images-message {
  text-align: center;
  padding: 3rem 1rem;
  background: #f9f9f9;
  border-radius: 8px;
  color: #666;
}

.no-images-message p {
  margin: 0.5rem 0;
}

.text-muted {
  opacity: 0.7;
}

/* Lightbox Styles */
.lightbox {
  display: none;
  position: fixed;
  z-index: 1000;
  left: 0;
  top: 0;
  width: 100%;
  height: 100%;
  background-color: rgba(0,0,0,0.9);
  backdrop-filter: blur(5px);
}

.lightbox-content {
  position: relative;
  margin: auto;
  padding: 0;
  width: 90%;
  max-width: 1200px;
  height: 100vh;
  display: flex;
  align-items: center;
  justify-content: center;
}

.lightbox-content img {
  max-width: 100%;
  max-height: 80vh;
  object-fit: contain;
  border-radius: 8px;
  cursor: grab;
  transition: transform 0.1s ease;
}

.lightbox-content img:active {
  cursor: grabbing;
}

.lightbox-content img.zoomed {
  cursor: grab;
}

.lightbox-close {
  position: absolute;
  top: 20px;
  right: 35px;
  color: #f1f1f1;
  font-size: 40px;
  font-weight: bold;
  cursor: pointer;
  z-index: 1001;
}

.lightbox-close:hover {
  color: #0073aa;
}

.lightbox-nav {
  position: absolute;
  top: 50%;
  transform: translateY(-50%);
  background: rgba(255,255,255,0.2);
  color: white;
  border: none;
  font-size: 2rem;
  padding: 1rem;
  cursor: pointer;
  border-radius: 50%;
  transition: background 0.3s ease;
  z-index: 1001;
}

.lightbox-nav button:hover {
  background: rgba(255,255,255,0.4);
}

.lightbox-prev {
  left: 20px;
}

.lightbox-next {
  right: 20px;
}

.lightbox-counter {
  position: absolute;
  bottom: 20px;
  left: 50%;
  transform: translateX(-50%);
  color: white;
  background: rgba(0,0,0,0.7);
  padding: 0.5rem 1rem;
  border-radius: 20px;
  font-size: 0.9rem;
}

.lightbox-help {
  position: absolute;
  bottom: 20px;
  right: 20px;
  color: white;
  background: rgba(0,0,0,0.7);
  padding: 0.5rem 1rem;
  border-radius: 8px;
  font-size: 0.8rem;
  opacity: 0.8;
}

.lightbox-help div {
  margin: 2px 0;
}

.realizzazione-footer {
  text-align: center;
  padding-top: 2rem;
  border-top: 1px solid #eee;
}

.btn-back {
  display: inline-block;
  padding: 0.75rem 1.5rem;
  background: #0073aa;
  color: white;
  text-decoration: none;
  border-radius: 5px;
  transition: background 0.3s ease;
}

.btn-back:hover {
  background: #005a87;
}

/* Stili per la sezione mappa */
.realizzazione-mappa {
  margin: 2rem 0;
  padding: 1.5rem;
  background: #f9f9f9;
  border-radius: 8px;
  border-left: 4px solid #0073aa;
}

.realizzazione-mappa h3 {
  margin: 0 0 1rem 0;
  color: #333;
  font-size: 1.3rem;
}

.mappa-container {
  background: white;
  border-radius: 8px;
  overflow: hidden;
  box-shadow: 0 2px 8px rgba(0,0,0,0.1);
}

.mappa-container iframe {
  width: 100%;
  height: 300px;
  border: 0;
  display: block;
}

.mappa-info {
  padding: 1rem;
  background: white;
  border-top: 1px solid #eee;
}

.mappa-info p {
  margin: 0.25rem 0;
  color: #666;
}

.mappa-info p:first-child {
  color: #333;
  font-weight: 600;
}

.mappa-link {
  padding: 1rem;
  background: white;
  border-top: 1px solid #eee;
  text-align: center;
}

.btn-mappa {
  display: inline-block;
  padding: 0.75rem 1.5rem;
  background: #4285f4;
  color: white;
  text-decoration: none;
  border-radius: 5px;
  font-weight: 500;
  transition: background 0.3s ease;
}

.btn-mappa:hover {
  background: #3367d6;
  transform: translateY(-2px);
  box-shadow: 0 4px 12px rgba(66, 133, 244, 0.3);
}

@media (max-width: 768px) {
  .galleria-grid {
    grid-template-columns: 1fr;
  }
  
  .realizzazione-dettaglio {
    padding: 1rem;
  }
  
  .lightbox-nav button {
    font-size: 1.5rem;
    padding: 0.5rem;
  }
  
  .lightbox-close {
    top: 10px;
    right: 20px;
    font-size: 30px;
  }
  
  /* Responsive per descrizioni */
  .immagine-descrizione {
    font-size: 0.8rem;
    padding: 0.5rem;
  }
  
  .lightbox-description {
    bottom: 60px;
    padding: 0.5rem 1rem;
    font-size: 0.9rem;
  }
  
  /* Responsive per la mappa */
  .realizzazione-mappa {
    margin: 1.5rem 0;
    padding: 1rem;
  }
  
  .mappa-container iframe {
    height: 250px;
  }
  
  .btn-mappa {
    padding: 0.6rem 1.2rem;
    font-size: 0.9rem;
  }
}
</style>

<script>
let currentImageIndex = 0;
let images = [];
let descriptions = [];
let currentScale = 1;
let isDragging = false;
let startX = 0;
let startY = 0;
let translateX = 0;
let translateY = 0;

// Inizializza le immagini quando la pagina si carica
document.addEventListener('DOMContentLoaded', function() {
  images = Array.from(document.querySelectorAll('.galleria-item img')).map(img => ({
    src: img.src,
    alt: img.alt
  }));
  
  // Crea array delle descrizioni
  descriptions = Array.from(document.querySelectorAll('.galleria-item')).map(item => {
    const descrizioneEl = item.querySelector('.immagine-descrizione');
    return descrizioneEl ? descrizioneEl.textContent.trim() : '';
  });
});

function openLightbox(index) {
  currentImageIndex = index;
  const lightbox = document.getElementById('lightbox');
  const lightboxImg = document.getElementById('lightbox-img');
  const counter = document.getElementById('lightbox-counter');
  const description = document.getElementById('lightbox-description');
  
  // Reset zoom e posizione
  currentScale = 1;
  translateX = 0;
  translateY = 0;
  
  if (images[index]) {
    lightboxImg.src = images[index].src;
    lightboxImg.alt = images[index].alt;
    lightboxImg.style.transform = `scale(${currentScale}) translate(${translateX}px, ${translateY}px)`;
    counter.textContent = `${index + 1} / ${images.length}`;
    
    // Mostra la descrizione se disponibile
    if (descriptions[index]) {
      description.textContent = descriptions[index];
      description.style.display = 'block';
    } else {
      description.style.display = 'none';
    }
    
    lightbox.style.display = 'block';
    document.body.style.overflow = 'hidden';
    
    // Aggiungi event listeners per zoom e drag
    setupImageInteractions(lightboxImg);
  }
}

function closeLightbox() {
  const lightbox = document.getElementById('lightbox');
  lightbox.style.display = 'none';
  document.body.style.overflow = 'auto';
  
  // Reset zoom e posizione
  currentScale = 1;
  translateX = 0;
  translateY = 0;
}

function changeImage(direction) {
  currentImageIndex += direction;
  
  if (currentImageIndex >= images.length) {
    currentImageIndex = 0;
  } else if (currentImageIndex < 0) {
    currentImageIndex = images.length - 1;
  }
  
  const lightboxImg = document.getElementById('lightbox-img');
  const counter = document.getElementById('lightbox-counter');
  const description = document.getElementById('lightbox-description');
  
  // Reset zoom e posizione per la nuova immagine
  currentScale = 1;
  translateX = 0;
  translateY = 0;
  
  lightboxImg.src = images[currentImageIndex].src;
  lightboxImg.alt = images[currentImageIndex].alt;
  lightboxImg.style.transform = `scale(${currentScale}) translate(${translateX}px, ${translateY}px)`;
  counter.textContent = `${currentImageIndex + 1} / ${images.length}`;
  
  // Aggiorna la descrizione
  if (descriptions[currentImageIndex]) {
    description.textContent = descriptions[currentImageIndex];
    description.style.display = 'block';
  } else {
    description.style.display = 'none';
  }
  
  // Rimuovi e aggiungi nuovamente i listener per la nuova immagine
  setupImageInteractions(lightboxImg);
}

function setupImageInteractions(img) {
  // Rimuovi event listeners esistenti per evitare duplicati
  img.onwheel = null;
  img.onmousedown = null;
  img.onmousemove = null;
  img.onmouseup = null;
  img.onmouseleave = null;
  
  // Zoom con rotella del mouse
  img.addEventListener('wheel', function(e) {
    e.preventDefault();
    
    const delta = e.deltaY > 0 ? -0.1 : 0.1;
    const newScale = Math.min(Math.max(0.5, currentScale + delta), 3);
    
    if (newScale !== currentScale) {
      currentScale = newScale;
      
      // Se stiamo rimpicciolendo sotto 1, resetta la posizione
      if (currentScale <= 1) {
        translateX = 0;
        translateY = 0;
        currentScale = 1;
      }
      
      img.style.transform = `scale(${currentScale}) translate(${translateX}px, ${translateY}px)`;
      
      // Aggiorna il cursore
      if (currentScale > 1) {
        img.classList.add('zoomed');
      } else {
        img.classList.remove('zoomed');
      }
    }
  });
  
  // Trascinamento
  img.addEventListener('mousedown', function(e) {
    if (currentScale > 1) {
      isDragging = true;
      startX = e.clientX - translateX;
      startY = e.clientY - translateY;
      img.style.cursor = 'grabbing';
      e.preventDefault();
    }
  });
  
  document.addEventListener('mousemove', function(e) {
    if (isDragging && currentScale > 1) {
      translateX = e.clientX - startX;
      translateY = e.clientY - startY;
      
      // Limita il trascinamento per evitare di trascinare troppo lontano
      const maxTranslate = 200 * currentScale;
      translateX = Math.min(Math.max(translateX, -maxTranslate), maxTranslate);
      translateY = Math.min(Math.max(translateY, -maxTranslate), maxTranslate);
      
      img.style.transform = `scale(${currentScale}) translate(${translateX}px, ${translateY}px)`;
    }
  });
  
  document.addEventListener('mouseup', function() {
    if (isDragging) {
      isDragging = false;
      img.style.cursor = currentScale > 1 ? 'grab' : 'default';
    }
  });
  
  img.addEventListener('mouseleave', function() {
    if (isDragging) {
      isDragging = false;
      img.style.cursor = currentScale > 1 ? 'grab' : 'default';
    }
  });
  
  // Double click per reset zoom
  img.addEventListener('dblclick', function() {
    currentScale = 1;
    translateX = 0;
    translateY = 0;
    img.style.transform = `scale(${currentScale}) translate(${translateX}px, ${translateY}px)`;
    img.classList.remove('zoomed');
  });
}

// Gestione dei tasti freccia per navigare nel lightbox
document.addEventListener('keydown', function(e) {
  const lightbox = document.getElementById('lightbox');
  if (lightbox.style.display === 'block') {
    if (e.key === 'ArrowLeft') {
      changeImage(-1);
    } else if (e.key === 'ArrowRight') {
      changeImage(1);
    } else if (e.key === 'Escape') {
      closeLightbox();
    } else if (e.key === '0' || e.key === 'r') {
      // Tasto 0 o R per reset zoom
      const lightboxImg = document.getElementById('lightbox-img');
      currentScale = 1;
      translateX = 0;
      translateY = 0;
      lightboxImg.style.transform = `scale(${currentScale}) translate(${translateX}px, ${translateY}px)`;
      lightboxImg.classList.remove('zoomed');
    }
  }
});
</script>
